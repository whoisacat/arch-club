components:

#  roles:
#    title: Roles
#    entity: boundary

#  external_system:
#    title: External systems
#    entity: label

  space_owner:
    title: Space owner
    entity: actor
    links:
      - title: Sends emails\nfor user
        id: email_system
        direction: <..[#green].
      - title: Sends push\nnotifications
        id: cash_flow_system
        direction: <..[#green].
      - title: Sends\nnotifications
        id: telegram_api
        direction: <-[#green]-
      - title: Sends queries\nto bots
        id: telegram_api
        direction: -[#red]->

  space_redactor:
    title: Space redactor
    entity: actor
    links:
      - title: Sends push\nnotifications
        id: cash_flow_system
        direction: <..[#green].
      - title: Sends\nnotifications
        id: telegram_api
        direction: <-[#green]-
      - title: Sends queries\nto bots
        id: telegram_api
        direction: -[#red]->

  space_reader:
    title: Space reader
    entity: actor
    links:
      - title: Sends push\nnotifications
        id: cash_flow_system
        direction: <..[#green].
      - title: Sends\nnotifications
        id: telegram_api
        direction: <-[#green]-
      - title: Sends queries\nto bots
        id: telegram_api
        direction: -[#red]->

  cash_flow_system:
    title: cash-flow
    entity: component
    links:
      - title: Record and read\nrevenues and expenses
        id: space_owner
        direction: <-[#red]-
      - title: Record and read\nrevenues and expenses
        id: space_redactor
        direction: <-[#red]-
      - title: Read revenues\nand expenses
        id: space_reader
        direction: <-[#blue]-

  cash_flow_system.web_ui_server:
    title: WEB UI
    entity: component
    links:
      - title: Read revenues\nand expenses
        id: space_reader
        direction: <-[#blue]-
      - title: Record and read\nrevenues and expenses
        id: space_owner
        direction: <-[#red]-
      - title: Record and read\nrevenues and expenses
        id: space_redactor
        direction: <-[#red]-

  cash_flow_system.mobile_app:
    title: Mobile App
    entity: component
    links:
      - title: Read revenues\nand expenses
        id: space_reader
        direction: <-[#blue]-
      - title: Record and read\nrevenues and expenses
        id: space_owner
        direction: <-[#red]-
      - title: Record and read\nrevenues and expenses
        id: space_redactor
        direction: <-[#red]-

  cash_flow_system.telegramm_bot:
    title: Tg bot
    entity: component
    links:
      - title: Read revenues\nand expenses
        id: space_reader
        direction: <-[#blue]-
      - title: Record and read\nrevenues and expenses
        id: space_owner
        direction: <-[#red]-
      - title: Record and read\nrevenues and expenses
        id: space_redactor
        direction: <-[#red]-

  cash_flow_system.api_gateway:
    title: API gateway
    entity: component
    links:
      - title: API\ncalls
        id: cash_flow_system.web_ui_server
        direction: <--
      - title: API\ncalls
        id: cash_flow_system.mobile_app
        direction: <--
      - title: API\ncalls
        id: cash_flow_system.telegramm_bot
        direction: <--
      - title: Expenses CRUD\n[JSON/HTTPS]
        id: cash_flow_system.expenses
        direction: -->
      - title: Accounting CRUD\n[JSON/HTTPS]
        id: cash_flow_system.accounts
        direction: -->

  cash_flow_system.keycloack:
    title: Keycloack
    entity: component
    technologies:
      - Of the shell product
    links:
      - title: Querries Oauth token\n[JSON/HTTPS]
        id: cash_flow_system.web_ui_server
        direction: <--
      - title: Querries Oauth token\n[JSON/HTTPS]
        id: cash_flow_system.mobile_app
        direction: <--
      - title: Querries Oauth token\n[JSON/HTTPS]
        id: cash_flow_system.telegramm_bot
        direction: <--
      - title: Makes API calls\n[JSON/HTTPS]
        id: cash_flow_system.api_gateway
        direction: <--

  cash_flow_system.expenses:
    title: Expenses
    entity: component
    links:
      - title: Validate token\n[JSON/HTTPS]
        id: cash_flow_system.keycloack
        direction: -->
      - title: Validate token\n[JSON/HTTPS]
        id: cash_flow_system.expenses_db
        direction: -[#maroon]->

  cash_flow_system.expenses_db:
    title: Expenses DB
    entity: database

  cash_flow_system.accounts:
    title: Accounts
    entity: component
    links:
      - title: Validate token\n[JSON/HTTPS]
        id: cash_flow_system.keycloack
        direction: -->
      - title: Validate token\n[JSON/HTTPS]
        id: cash_flow_system.accounts_db
        direction: -[#maroon]->
      - title: Get referential data\n[JSON/HTTPS]
        id: dadata_system
        direction: -[#blue]->
      - title: Get referential data\n[JSON/HTTPS]
        id: dadata_system
        direction: -[#blue]->
      - title: Event notification\n[Kafka Message\n/TCP]
        id: cash_flow_system.revenues
        direction: <.[#orange].>
      - title: Event notification\n[Kafka Message\n/TCP]
        id: cash_flow_system.expenses
        direction: <.[#orange].>
      - title: Get details\nof event\n[JSON/HTTPS]
        id: cash_flow_system.revenues
        direction: <-->
      - title: Get details\nof event\n[JSON/HTTPS]
        id: cash_flow_system.expenses
        direction: <-->

  cash_flow_system.accounts_db:
    title: Accounts DB
    entity: database

  cash_flow_system.revenues:
    title: Revenues
    entity: component
    links:
      - title: Validate token\n[JSON/HTTPS]
        id: cash_flow_system.keycloack
        direction: -->
      - title: Validate token\n[JSON/HTTPS]
        id: cash_flow_system.revenues_db
        direction: -[#maroon]->

  cash_flow_system.revenues_db:
    title: Revenues DB
    entity: database

  external_notification_system:
    title: Firebase\nCloud\nMessaging
    entity: cloud
    links:
      - title: Sends notifications\nto customers
        id: cash_flow_system.mobile_app
        direction: -->
      - title: Sends notifications\nto customers
        id: cash_flow_system.mobile_app
        direction: <--
      - title: Sends notifications\nto customers
        id: cash_flow_system
        direction: -->
      - title: Sends notifications\nto customers
        id: cash_flow_system
        direction: <--

  telegram_api:
    title: Telegram\nAPI
    entity: cloud
    links:
      - title: Sends queries\nfrom bots
        id: cash_flow_system
        direction: -->
      - title: Sends notifications\nand data
        id: cash_flow_system
        direction: <--

  email_system:
    title: GMAIL
    entity: cloud
    links:
      - title: Sends emails
        id: cash_flow_system
        direction: <--

  dadata_system:
    title: DADATA
    entity: cloud
    links:
      - title: Queries\nreferential information
        id: cash_flow_system
        direction: <--

contexts:
  LevelContext:
    title: System Context diagram
    location: context
    extra-links: false
    components:
      - space_reader
      - space_redactor
      - space_owner
      - cash_flow_system
      - dadata_system
      - email_system
      - external_notification_system
      - telegram_api
  LevelComponent:
    title: System Component diagram
    location: container
    extra-links: false
    components:
      - space_reader
      - space_redactor
      - space_owner
      - cash_flow_system.*
      - dadata_system
      - email_system
      - external_notification_system
      - telegram_api
